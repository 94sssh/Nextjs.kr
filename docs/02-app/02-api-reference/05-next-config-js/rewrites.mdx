---
title: rewrites
description: 귀하의 Next.js 어플리케이션에 rewrites를 사용하세요.
---

Rewrites는 들어오는 요청 경로를 다른 목적 경로로 매핑해줍니다.

Rewrites는  URL 프록시처럼 기능하며 목적 경로를 가려주어 유저가 사이트의 주소를 바꾸지 않은 것처럼 보이게 합니다. 반면, [redirects](/docs/pages/api-reference/next-config-js/redirects) 새로운 페이지로 다시 라우팅해주며 URL 변화를 보여줍니다.

rewrite를 사용하기 위해 `next.config.js`에 `rewrites` 함수를 사용할 수 있습니다:

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/about',
        destination: '/',
      },
    ]
  },
}
```

Rewrites는 클라이언트 측 라우팅에 적용되며, 위의 예제에서 `<Link href="/about">` 는 rewrites가 적용될 것입니다.

`rewrites`는 비동기 함수로, `source`와 `destination` 속성을 갖는 객체를 포함하는 배열 또는 배열들로 구성된 객체를 반환합니다.

- `source`: `String` - 들어오는 요청 경로 패턴입니다.
- `destination`: `String` 라우팅하기를 원하는 경로입니다.
- `basePath`: `false` or `undefined` - false인 경우 매칭 시 basePath가 포함되지 않으며 외부 rewrites에만 사용할 수 있습니다.
- `locale`: `false` or `undefined` - 매칭 시 로케일이 포함되지 말아야 하는지 아닌지를 나타냅니다.
- `has` 는 [has objects](#header-cookie-and-query-matching)로 구성된 배열입니다. 이는 `type`, `key` 그리고 `value` 속성을 포함합니다.
- `missing` 은 [missing objects](#header-cookie-and-query-matching)로 구성된 배열입니다. 이는 `type`, `key` 그리고 `value` 속성을 포함합니다.

`rewrites` 함수가 배열을 반환할 때, rewrites는 filesystem(pages and `/public` 파일들)을 확인한 뒤 동적 라우트 전에 적용됩니다. `rewrites` 함수가 배열로 구성된 객체를 특정한 형태로 반환할 때, 이러한 동작은 바뀔 수 있으며 Next.js의 `v10.1` 부터 더 세밀하게 제어됩니다:

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return {
      beforeFiles: [
        // These rewrites are checked after headers/redirects
        // and before all files including _next/public files which
        // allows overriding page files
        {
          source: '/some-page',
          destination: '/somewhere-else',
          has: [{ type: 'query', key: 'overrideMe' }],
        },
      ],
      afterFiles: [
        // These rewrites are checked after pages/public files
        // are checked but before dynamic routes
        {
          source: '/non-existent',
          destination: '/somewhere-else',
        },
      ],
      fallback: [
        // These rewrites are checked after both pages/public files
        // and dynamic routes are checked
        {
          source: '/:path*',
          destination: `https://my-old-site.com/:path*`,
        },
      ],
    }
  },
}
```

> **Good to know**: `beforeFiles`의 rewrites는 파일시스템/동적 라우트를 source매칭 직후에 체크하지 않습니다. 이들은 `beforeFiles`가 확인될 때까지 계속됩니다. 

Next.js에서 경로가 확인되는 순서:

1. [headers](/docs/pages/api-reference/next-config-js/headers) 가 확인 및 적용됩니다
2. [redirects](/docs/pages/api-reference/next-config-js/redirects) 가 확인 및 적용됩니다
3. `beforeFiles` 의 rewrites가 가 확인 및 적용됩니다
4. static files from the [public directory](/docs/pages/building-your-application/optimizing/static-assets) 의 정적인 파일들, `_next/static` 파일들, 그리고 동적이지 않은 페이지들이 확인되고 제공됩니다
5. `afterFiles` rewrites가 확인되고 적용됩니다. 만약 이들 rewrites 중 하나가 매치되면 우리는 동적인 경로들/정적인 파일들을 각각의 매치 후 확인합니다
6. `fallback` rewrites 가 확인 및 적용됩니다. 이들은 404 페이지가 렌더링 되기 전 그리고 동적인 경로들과 모든 정적인 assets들이 확인된 후 적용됩니다 만약 당신이 `getStaticPaths` 에서 [fallback: true/'blocking'](/docs/pages/api-reference/functions/get-static-paths#fallback-true) 를 사용한다면, 당신의 `next.config.js` 에 정의된 fallback `rewrites` 는 동작하지 _않습니다_.

## Rewrite 파라미터들

rewirte에서 파라미터를 사용할 때, 파라미터 중 어느것도 `destinaion`에 사용되지 않으면 그 파라미터들은 쿼리에 기본값으로 전달됩니다. 

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/old-about/:path*',
        destination: '/about', // The :path parameter isn't used here so will be automatically passed in the query
      },
    ]
  },
}
```

만약 파라미터가 destination에 사용된다면 파라미터 중 어느 것도 쿼리에 자동으로 전달되지 않습니다. 

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/docs/:path*',
        destination: '/:path*', // The :path parameter is used here so will not be automatically passed in the query
      },
    ]
  },
}
```

만약 파라미터가 이미 목적지에 사용되고 있다면 `destination` 에 쿼리를 명시함으로써 파라미터들을 직접 쿼리에 전달할 수 있습니다. 

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/:first/:second',
        destination: '/:first?second=:second',
        // Since the :first parameter is used in the destination the :second parameter
        // will not automatically be added in the query although we can manually add it
        // as shown above
      },
    ]
  },
}
```

> **Good to know**: Static pages from [Automatic Static Optimization](/docs/pages/building-your-application/rendering/automatic-static-optimization) 의 정적인 페이지들 또는 rewrites로부터 온 [prerendering](/docs/pages/building-your-application/data-fetching/get-static-props) 파라미터들은 하이드레이션과 쿼리에 제공된 이후 클라이언트측에 파싱됩니다. 

## 경로 매칭

경로 매칭은 허용됩니다. 예를 들면 `/blog/:slug` 는 `/blog/hello-world` 에 매칭됩니다. (no nested paths):

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/blog/:slug',
        destination: '/news/:slug', // Matched parameters can be used in the destination
      },
    ]
  },
}
```

### 와일드카드 경로 매칭

와일드카드 경로를 매칭하기 위해, 당신은 파라미터 후에 `*` 을 사용할 수 있습니다. 예를 들어 `/blog/:slug*` 는 `/blog/a/b/c/d/hello-world`에 매칭됩니다:

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/blog/:slug*',
        destination: '/news/:slug*', // Matched parameters can be used in the destination
      },
    ]
  },
}
```

### 정규식 경로 매칭

정규식 경로를 매칭하기 위해 당신은 정규식을 파라미터 이후, parenthsis에 정규식을 감쌀 수 있습니다. 예를 들어 `/blog/:slug(\\d{1,})` 는 `/blog/123` 에 매칭되지만 `/blog/abc` 에는 매칭되지 않습니다:

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/old-blog/:post(\\d{1,})',
        destination: '/blog/:post', // Matched parameters can be used in the destination
      },
    ]
  },
}
```

다음의 문자들 `(`, `)`, `{`, `}`, `:`, `*`, `+`, `?` 은 정규식 경로 매칭에 사용됩니다. 따라서 `source` 에서 특별하지 않은 값으로 사용될 때에는 위 문자들 앞에 반드시 `\\` 를 더해야 합니다:

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        // this will match `/english(default)/something` being requested
        source: '/english\\(default\\)/:slug',
        destination: '/en-us/:slug',
      },
    ]
  },
}
```

## 헤더, 쿠키, 그리고 쿼리 매칭

오직 헤더, 쿠키, 쿼리 값들이 `has` 필드와 매치되거나 `missing` 필드와 매치되지 않을 때에만 rewrites를 사용할 수 있습니다. rewrite가 적용되기 위해 `source` 와 모든 `has` 아이템들은 모두 매치되어야 하며 모든  `missing` 아이템들은 매치되지 않아야 합니다. 

`has` 와 `missing` 항목들은 다음의 필드를 가질 수 있습니다:

- `type`: `String` - `header`, `cookie`, `host`, `query` 중 하나여야만 합니다.
- `key`: `String` - 비교하기로 선택한 유형의 키.
- `value`: `String` or `undefined` - 확인해야 할 값, 만약 undefined라면 아무 값이나 매치됩니다. 문자열과 같은 정규식은 값의 특정한 부분을 포착하는 데에 사용될 수 있습니다. 예를 들어 만약  `first-(?<paramName>.*)` 가 `first-second` 를 위해 사용되었다면 `second` 는 도착 경로에 `:paramName` 와 함께 사용가능합니다. 

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      // if the header `x-rewrite-me` is present,
      // this rewrite will be applied
      {
        source: '/:path*',
        has: [
          {
            type: 'header',
            key: 'x-rewrite-me',
          },
        ],
        destination: '/another-page',
      },
      // if the header `x-rewrite-me` is not present,
      // this rewrite will be applied
      {
        source: '/:path*',
        missing: [
          {
            type: 'header',
            key: 'x-rewrite-me',
          },
        ],
        destination: '/another-page',
      },
      // if the source, query, and cookie are matched,
      // this rewrite will be applied
      {
        source: '/specific/:path*',
        has: [
          {
            type: 'query',
            key: 'page',
            // the page value will not be available in the
            // destination since value is provided and doesn't
            // use a named capture group e.g. (?<page>home)
            value: 'home',
          },
          {
            type: 'cookie',
            key: 'authorized',
            value: 'true',
          },
        ],
        destination: '/:path*/home',
      },
      // if the header `x-authorized` is present and
      // contains a matching value, this rewrite will be applied
      {
        source: '/:path*',
        has: [
          {
            type: 'header',
            key: 'x-authorized',
            value: '(?<authorized>yes|true)',
          },
        ],
        destination: '/home?authorized=:authorized',
      },
      // if the host is `example.com`,
      // this rewrite will be applied
      {
        source: '/:path*',
        has: [
          {
            type: 'host',
            value: 'example.com',
          },
        ],
        destination: '/another-page',
      },
    ]
  },
}
```

## Rewriting to an external URL

<details>
  <summary>예제들</summary>

- [Incremental adoption of Next.js](https://github.com/vercel/next.js/tree/canary/examples/custom-routes-proxying)
- [Using Multiple Zones](https://github.com/vercel/next.js/tree/canary/examples/with-zones)

</details>

Rewrites는 당신이 외부 url로 고쳐쓸 수 있게 합니다. 이는 특히 점진적으로 적용되는 Next.js에 유용합니다. 다음 예제는 당신의 메인 어플의 `/blog` 경로를 외부 사이트로 리다이렉팅하기 위해 rewrite를 사용합니다. 

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return [
      {
        source: '/blog',
        destination: 'https://example.com/blog',
      },
      {
        source: '/blog/:slug',
        destination: 'https://example.com/blog/:slug', // Matched parameters can be used in the destination
      },
    ]
  },
}
```

만약 당신이 `trailingSlash: true` 를 사용하고 있다면, 당신은 또한 후행 슬래쉬를 `source` 파라미터에 삽입해야 합니다. 만약 목적지 서버가 후행 슬래쉬를 기대한다면 이를 `destination` 파라미터에도 포함해야 합니다. 

```js filename="next.config.js"
module.exports = {
  trailingSlash: true,
  async rewrites() {
    return [
      {
        source: '/blog/',
        destination: 'https://example.com/blog/',
      },
      {
        source: '/blog/:path*/',
        destination: 'https://example.com/blog/:path*/',
      },
    ]
  },
}
```

### Next.js의 점진적인 적용 

또한 모든 Next.js 경로를 확인한 후 Next.js가 기존 웹 사이트에 대한 프록시로 폴백되도록 할 수 있습니다. 이렇게 하면 더 많은 페이지를 Next.js로 마이그레이션할 때 rewrites 구성을 변경할 필요가 없습니다.

```js filename="next.config.js"
module.exports = {
  async rewrites() {
    return {
      fallback: [
        {
          source: '/:path*',
          destination: `https://custom-routes-proxying-endpoint.vercel.app/:path*`,
        },
      ],
    }
  },
}
```

### rewrites의 basePath 지원

[`basePath` support](/docs/app/api-reference/next-config-js/basePath) 를 rewrites와 함께 사용할 때, rewrite에 `basePath: false` 를 추가하지 않으면 각 `source` 와 `destination` 에 자동적으로 `basePath` 접두사가 붙습니다. 

```js filename="next.config.js"
module.exports = {
  basePath: '/docs',

  async rewrites() {
    return [
      {
        source: '/with-basePath', // automatically becomes /docs/with-basePath
        destination: '/another', // automatically becomes /docs/another
      },
      {
        // does not add /docs to /without-basePath since basePath: false is set
        // Note: this can not be used for internal rewrites e.g. `destination: '/another'`
        source: '/without-basePath',
        destination: 'https://example.com',
        basePath: false,
      },
    ]
  },
}
```

### rewrites의 i18n 지원 

[`i18n` support](/docs/pages/building-your-application/routing/internationalization) 를 rewrites와 사용할 때, rewrite에 `locale: false`를 추가하지 않으면 구성된 `locales` 를 처리하기 위해 각 `source` 와 `destination` 에 자동적으로 접두사가 붙습니다. 만약 `locale: false` 를 사용한다면 정확하게 매치되게 하기 위해 locale로 `source` and `destination` 에 접두사를 붙여야 한다. 

```js filename="next.config.js"
module.exports = {
  i18n: {
    locales: ['en', 'fr', 'de'],
    defaultLocale: 'en',
  },

  async rewrites() {
    return [
      {
        source: '/with-locale', // automatically handles all locales
        destination: '/another', // automatically passes the locale on
      },
      {
        // does not handle locales automatically since locale: false is set
        source: '/nl/with-locale-manual',
        destination: '/nl/another',
        locale: false,
      },
      {
        // this matches '/' since `en` is the defaultLocale
        source: '/en',
        destination: '/en/another',
        locale: false,
      },
      {
        // it's possible to match all locales even when locale: false is set
        source: '/:locale/api-alias/:path*',
        destination: '/api/:path*',
        locale: false,
      },
      {
        // this gets converted to /(en|fr|de)/(.*) so will not match the top-level
        // `/` or `/fr` routes like /:path* would
        source: '/(.*)',
        destination: '/another',
      },
    ]
  },
}
```

## 버전 히스토리

| Version   | Changes          |
| --------- | ---------------- |
| `v13.3.0` | `missing` added. |
| `v10.2.0` | `has` added.     |
| `v9.5.0`  | Headers added.   |
